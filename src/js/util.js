window.gm=window.gm||parent.gm||{},window.ES6Promise&&!window.Promise&&ES6Promise.polyfill(),gm.util=function(e){"use strict";function n(){}function t(){return gm.info.vehicleConfig.maskingFeature}function i(e){var n=document.getElementById(P.id);e=e||{};for(var t in P)e[t]&&(P[t]=e[t]);n&&o(n)}function o(e,n){"true"===n||n===!0?e.classList.add("gpsMaskingEnabled"):e.classList.remove("gpsMaskingEnabled");for(var t in P)e.style[t]=P[t]}function a(){var e=document.querySelector("#"+P.id);e.parentNode.removeChild(e)}function r(e){var n=document.querySelector("#"+P.id);return n?o(n,e):(n=document.createElement("button"),n.id=P.id,n.onclick=c,document.body.appendChild(n),void o(n,e))}function c(){u();var e=JSON.stringify({command:"deeplink",appID:"15",message:JSON.stringify({senderID:gm.system.getAppConfig("AppID"),page:"gps_masking"})}),n=(gm.comm||gm.communication).sendToApp(3,e.length,e);~[1,2,3,4].indexOf(n)&&s(),_=(gm.comm||gm.communication).watchForData(l)}function u(){var e=document.querySelector("#"+P.id);e.classList.add("spinner")}function s(){var e=document.querySelector("#"+P.id);e.classList.remove("spinner")}function l(e){var n=JSON.parse(e.data),t=gm.info.vehicleConfig.region,i=n&&"15"===n.senderID;i&&(s(),(gm.comm||gm.communication).clearWatchForData(_),"true"===n.gpsMaskingEnabled||n.gpsMaskingEnabled===!0?n.gpsMaskingEnabled=!0:n.gpsMaskingEnabled=!1,Array.isArray(n.gpsMaskingExclusionList)&&(gm.info.vehicleConfig.maskingFeature=!~n.gpsMaskingExclusionList.indexOf(t)),gm.info.vehicleConfig.gpsMaskingEnabled=n.gpsMaskingEnabled,gm.info.vehicleConfig.maskingFeature===!0?r(gm.info.vehicleConfig.gpsMaskingEnabled):a())}function p(e){function n(n){var t=gm.info.vehicleConfig.maskingFeature,i=gm.info.vehicleConfig.gpsMaskingEnabled&&t;r(i),t||a(),e(i)}e=e||gm.util.optionalMethod;gm.comm||gm.communication;gm.info.getConfigFromApp3().then(n)}function g(e){function n(n,c){var u;return c=c||d,r.length||(o=a=e.watchMethod(i,function(){t(u.id),c()})),u={id:o++,success:n,failure:c},r.push(u),u.id}function t(n){1===r.length&&e.clearMethod(a),r.forEach(function(e,t){e.id===n&&r.splice(t,1)})}function i(){var e,n=Array.prototype.slice.apply(arguments);c?r.forEach(function(e){e.success.apply(null,n)}):(e=r[r.length-1],e&&e.success.apply(null,n))}if(!E(e.watchMethod))throw new TypeError("config object requires watchMethod key {Function}");if(!E(e.clearMethod))throw new TypeError("config object requires clearMethod key {Function}");var o,a,r=[],c="single"!==e.type;this.add=n,this.clear=t}function f(){return gm.system.getAppConfig("AppCategory")}function d(){h("Optional, unprovided callback executed.",arguments)}function m(e){return"function"==typeof e?e:n}function h(){var e=[].slice.call(arguments);e.unshift("APP0 >>"),console.log.apply(console,e)}function v(e,n,t,i){i=i||{},i.request_id=j,n=m(n),t=m(t);var o=JSON.stringify({command:e,data:i});L[j]={success:n,failure:t},j++;var a=gm.communication.sendToApp(3,o.length,o);y(a,o),a&&t()}function y(e,n){var t=["sendToApp success","sendToApp failed: App not installed","sendToApp failed: App not started","sendToApp failed: Invalid data","sendToApp failed: App not watching for data"];h(t[e],n)}function E(e){return"function"==typeof e}function b(e){return"[object Object]"===Object.prototype.toString.call(e)}function A(e){return"number"==typeof e}function M(e){return"string"==typeof e}function O(n){return n===e}function S(e){return Array.isArray(e)}function k(e){return"boolean"==typeof e}function I(e){for(var n=[],t=0;t<e.length;t++){var i=e[t];E(i)?n.push("f"):b(i)?n.push("o"):S(i)?n.push("o"):A(i)?n.push("n"):M(i)?n.push("s"):k(i)?n.push("b"):O(i)&&n.push("u")}return n.join("")}function T(e,n){return e===n}function w(e){var n=F.call(arguments,1);return n.forEach(function(n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])}),e}var N=Object.create(null,{INVALID_SIGNATURE:{value:0},NOT_SUPPORTED:{value:1},NOT_INITIALIZED:{value:2},FORBIDDEN_CONTENT:{value:3},REQUEST_TIMEOUT:{value:4},INVALID_OPTIONS:{value:5}}),C=Object.create(null,{HIGH:{value:1e3},MEDIUM:{value:5e3},LOW:{value:1e4}}),D=Object.create(null,{ENABLED:{value:!1},EXCLUDED_REGIONS:{value:["USA","Canada"]}}),L={},j={},F=Array.prototype.slice,P=Object.create(Object.prototype,{id:{value:"gpsMaskingIcon"},top:{value:null,enumerable:!0,writable:!0},right:{value:null,enumerable:!0,writable:!0},bottom:{value:null,enumerable:!0,writable:!0},left:{value:null,enumerable:!0,writable:!0}}),_=0;return{sendToApp3:v,EXCEPTIONS:N,POLLING:C,GPS_MASKING_DEFAULTS:D,extend:w,noop:n,log:h,isFunction:E,isObject:b,isNumber:A,isString:M,isUndefined:O,isBoolean:k,getSig:I,matchesSig:T,optionalMethod:d,handleOptionalMethod:m,WatchManager:g,getAppType:f,getGpsMaskingSupport:t,requestGpsMaskingState:p,setGpsButtonConfig:i,removeSpinner:s}}();